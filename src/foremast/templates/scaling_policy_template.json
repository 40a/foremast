{
   "application":"{{ app }}",
   "description":"Upsert scaling policy",
   "job":[
      {
         "serverGroupName":"{{ server_group }}",
         "credentials":"{{ env }}",
         "region":"{{ region }}",
         "provider":"aws",
         "adjustmentType":"ChangeInCapacity",
         "alarm":{
            "region":"{{ region }}",
            "actionsEnabled":true,
            "comparisonOperator":"GreaterThanThreshold",
            "dimensions":[
               {
                  "name":"AutoScalingGroupName",
                  "value":"{{ server_group }}"
               }
            ],
            "evaluationPeriods":1,
            "period":{{ scaling_policy.period | default(60) }},
            "threshold": {{ scaling_policy.threshold }} ,
            "namespace":"AWS/EC2",
            "metricName":"{{ scaling_policy.metric | default("CPUUtilization") }}",
            "statistic":"{{ scaling_policy.statistic |default("Average") }}"
         },
         "step":{
            "estimatedInstanceWarmup":600,
            "metricAggregationType":"Average",
            "stepAdjustments":[
               {
                  "scalingAdjustment":3,
                  "metricIntervalLowerBound":0
               }
            ]
         },
         "type":"upsertScalingPolicy",
         "user":"pipes-autoscaling-policy"
      }
   ]
}
